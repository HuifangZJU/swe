# 进程与线程

## 进程和线程定义

1. 进程是一个正在执行的程序，包括两个基本元素（程序代码和数据集）；线程
2. 进程内存：程序代码、数据段（C中包括未初始化数据段BSS、初始化数据段；C++中已经没有了）、寄存器、堆、栈
线程内存：寄存器、栈


## 进程通信（IPC, Inter-Process Communication）
总的来说有：管道, 系统IPC(包括消息队列,信号量,共享存储), SOCKET。


1. 管道(pipe)
   * 第一个广泛使用的IPC形式，即可在程序中使用，也可在shell中使用。
   > * 无名管道： 只能在具有共同祖先（指父子进程关系）的进程间使用。
   * 有名管道（named pipe）: 即FIFO

2. 消息队列（message queue）
   * System V 消息队列
   * Posix消息队列

3. 信号量

4. 共享存储
   * 共享内存
   * 文件映射

5. socket

~~5. 远程过程调用（Remote Procedure Call, RPC）~~
~~从客户主机上摸个程序调用服务器主机上某个函数的一种方法。~~
远程过程调用不属于进程通信的方式

## 进程/线程 通信/同步

1. 进程谈通信，线程谈同步
2. 进程间也有同步问题，而IPC是同步的实现手段。


## 进程通信
主要有： 临界区（Critical Section）、信号量（Semaphore）、管程。

1. 临界区（critical section）
2. 信号量（semaphore）
   * System V信号量
   * Posix信号量
3. 管程
定义了一个数据结构和在该数据结构上能为并发进程所执行的一组操作。这些操作能同步进程和改变管程中的数据。它是一种进程同步机制。在结构上类似于面向对象中的类。在功能上和信号量和p，v操作类似。可以更方便的管理系统的临界资源。


## 线程同步
信号量（Semaphore）、互斥量（Mutex）、读写锁、条件变量

1. 信号量（semaphore）
2. 互斥量（mutex）
3. 读写锁（read-write lock）
4. 条件变量（condition variable）


参考博客:
[作业、进程、线程、管程、管道概念梳理](http://blog.csdn.net/zhubo22/article/details/8043685)
[进程/线程同步的方式和机制，进程间通信](http://www.cnblogs.com/memewry/archive/2012/08/22/2651696.html)


## 多线程编程中存在什么问题
1. 互斥与同步
2. 死锁与饥饿

### 死锁的必要条件：
1. 互斥：同一时刻只有一个进程能访问某一资源；
2. 持有并等待：已持有某一资源的进程不必释放当前拥有的资源；
3. 没有抢占：一个进程不能强制另一个进程释放资源；
4. 循环等待：两个或两个以上的进程形成循环链，每个进程都在等待循环链中另一个进程持有的资源。


## 守护、孤儿、僵尸进程
* 守护进程：创建守护进程时有意把父进程结束，然后被1号进程init收养
* 孤儿进程：因为父进程异常结束了，然后被1号进程init收养。
* 僵尸进程： 一个进程使用fork创建子进程，如果子进程退出，而父进程并没有调用wait或waitpid获取子进程的状态信息，那么子进程的进程描述符仍然保存在系统中。这种进程称之为僵死进程。
* 区别
一个正常运行的子进程，如果此刻子进程退出，父进程没有及时调用wait或waitpid收回子进程的系统资源，该进程就是僵尸进程，如果系统收回了，就是正常退出，如果一个正常运行的子进程，父进程退出了但是子进程还在，该进程此刻是孤儿进程，被init收养，如果父进程是故意被杀掉，子进程做相应处理后就是守护进程
